# Receipt Processor

A simple receipt processing application that calculates points based on specific rules. This application is built using Go and uses Gorilla Mux for routing.

## Table of Contents

- [Features](#features)
- [Installation](#installation)
- [Running the Application](#running-the-application)
  - [Locally](#locally)
  - [Using Docker](#using-docker)
- [Project Structure](#project-structure)
- [Api Endpoints](#api-endpoints)
- [Validation](#validation)
- [Testing](#testing)

## Features

- Process receipts to calculate points.
- Retrieve points for a processed receipt.
- Input validation to ensure correct receipt format.

## Installation

### Prerequisites

- Go 1.20 or later
- Docker (if running using Docker)

### Running the Application

#### Locally

1. Clone the repository:

    ```sh
    git clone https://github.com/pjaiaditya007/receipt-processor.git
    cd receipt-processor
    ```

2. Install dependencies:

    ```sh
    go mod tidy
    ```

3. Run the application:

    ```sh
    go run main.go
    ```

The application will start on `http://localhost:8080`.

#### Using Docker

1. Clone the repository:

    ```sh
    git clone https://github.com/yourusername/receipt-processor.git
    cd receipt-processor
    ```

2. Build the Docker image:

    ```sh
    docker build -t receipt-processor .
    ```

3. Run the Docker container:

    ```sh
    docker run -p 8080:8080 receipt-processor
    ```

The application will be accessible on `http://localhost:8080`.

## Project Structure

```plaintext
receipt-processor/
├── main.go
├── models/
│   └── receipt.go
├── handlers/
│   └── receipt.go
├── validation/
│   └── receipt.go
├── points/
│   └── calculation.go
├── routes/
│   └── routes.go
├── tests/
│   └── receipt_test.go
├── go.mod
├── go.sum
└── openapi.yaml
```

### Api Endpoints

## Endpoint: Process Receipts

* Path: `/receipts/process`
* Method: `POST`
* Payload: Receipt JSON
* Response: JSON containing an id for the receipt.

Description:

Takes in a JSON receipt and returns a JSON object with an ID generated by your code.

The ID returned is the ID that should be passed into `/receipts/{id}/points` to get the number of points the receipt was awarded.

How many points should be earned are defined by the rules below.

Reminder: Data does not need to survive an application restart. This is to allow you to use in-memory solutions to track any data generated by this endpoint.

Example Response:
```json
{ "id": "7fb1377b-b223-49d9-a31a-5a02701dd310" }
```

## Endpoint: Get Points

* Path: `/receipts/{id}/points`
* Method: `GET`
* Response: A JSON object containing the number of points awarded.

A simple Getter endpoint that looks up the receipt by the ID and returns an object specifying the points awarded.

Example Response:
```json
{ "points": 32 }
```

### Validation

**Note:** The API strictly adheres to the OpenAPI YAML file and will fail if the request body does not conform to the schema.

This code includes print statements to output error messages in case of validation failures. These messages aid in debugging and provide clarity on why a validation failed. The validation logic ensures the following:

- Retailer names adhere to the specified pattern.
- There is at least one item in the receipt.
- Each item's short description matches the specified pattern.
- Each item's price matches the specified pattern.
- The total price matches the specified pattern.
- The purchase date and time are in valid formats.


### How to Test

To test the project, follow these steps:

1. Ensure you have installed the necessary dependencies by running:

    ```sh
    go mod tidy
    ```

2. Run the tests using the following command:

    ```sh
    go test ./tests
    ```

This command will execute all the test functions in the `tests` package and report any failures.

### Explanation

- **Features**: Lists the main functionalities of the application.
- **Installation**: Instructions for cloning the repository and installing dependencies.
- **Running the Application**: Instructions for running the application locally and using Docker.
- **Project Structure**: Describes the structure of the project and the purpose of each file.
- **API Endpoints**: Provides details on the available API endpoints, including request and response formats.
- **Validation**: Highlights the strict adherence to the OpenAPI YAML schema and mentions the added print statements for validation failures.
- **Testing**: Provides instructions for running tests and details of the test cases used to validate the receipt processing logic.
